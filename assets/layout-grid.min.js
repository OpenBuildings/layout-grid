+function(a,b){"use strict";function c(b,c,d,e){return this.each(function(){var g=a(this),h=g.data("cl.lt_grid");h||g.data("cl.lt_grid",h=new f(this)),"string"==typeof b&&h[b](c,d,e)})}var d=function(a,b,c,d){this.x=a||0,this.y=b||0,this.w=c||1,this.h=d||1};d.prototype.bottom=function(){return this.y+this.h},d.prototype.right=function(){return this.x+this.w},d.prototype.intersect=function(a){return this.x<a.right()&&this.right()>a.x&&this.y<a.bottom()&&this.bottom()>a.y},d.prototype.setCss=function(a,b){var c=this;return["x","y","w","h"].forEach(function(d){a=a.replace(new RegExp("lt-"+b+"-"+d+"-(\\d+)"),"lt-"+b+"-"+d+"-"+c[d])}),a},d.prototype.loadCss=function(a,b){var c=this;return["x","y","w","h"].forEach(function(d){var e=a.match(new RegExp("lt-"+b+"-"+d+"-(\\d+)"));e&&(c[d]=parseInt(e[1]))}),this};var e=function(a){this.rects=a||[]};e.prototype.getIntersectingRects=function(b){return a.grep(this.rects,function(a){return b!==a&&b.intersect(a)})},e.prototype.compact=function(){var b=this,c=this.rects.slice(0).sort(function(a,b){return a.y-b.y});return a.each(c,function(){do this.y-=1;while(this.y>=0&&0===b.getIntersectingRects(this).length);this.y+=1}),this},e.prototype.height=function(){var b=a.map(this.rects,function(a){return a.bottom()});return b?Math.max.apply(null,b):0},e.prototype.move=function(b,c,d){var e=this;return b.x=c,b.y=d,a.each(this.getIntersectingRects(b),function(){e.move(this,this.x,b.bottom())}),this},a.fn.lt_rect=function(a,c){return b===c?(b===this.data("lt-item-"+a)&&this.data("lt-item-"+a,(new d).loadCss(this.attr("class"),a)),this.data("lt-item-"+a)):(this.data("lt-item-"+a,c),this.attr("class",c.setCss(this.attr("class"),a)),this)},a.fn.lt_ensure_id=function(){return this.filter(function(){return!this.id}).each(function(){this.id="rect-"+Math.round((new Date).getTime()+100*Math.random())}),this};var f=function(b){this.$element=a(b),this.$ghost=null,this.$mask=null,this.overlap=this.$element.data("overlap")||!1,this.options=a.extend({lg:{gap:1,maxWidth:Number.MAX_VALUE,cols:4,aspect:2/3},md:{gap:2,maxWidth:1200,cols:3,aspect:2/3},sm:{gap:3,maxWidth:992,cols:2,aspect:2/3},xs:{gap:4,maxWidth:768,cols:1,aspect:2/3}},this.$element.data("options")||{})};f.prototype.size=function(){var b,c=a(window).width();return a.each(this.options,function(a,d){c<d.maxWidth&&(b=a)}),b},f.prototype.ghost=function(b){return null===this.$ghost&&(this.$ghost=a('<div class="'+b.attr("class")+' lt-ghost"></div>'),this.$element.append(this.$ghost)),this.$ghost},f.prototype.remove_ghost=function(){this.$ghost&&(this.$ghost.remove(),this.$ghost=null)},f.prototype.resize=function(){var a=this.size(),b=new d(0,0,0,this.grid().height());this.$element.attr("class",b.setCss(this.$element.attr("class"),a))},f.prototype.item_width=function(a){return(this.$element.width()-(this.options[a].cols-1)*this.options[a].gap)/this.options[a].cols},f.prototype.item_height=function(a){return this.item_width(a)*this.options[a].aspect},f.prototype.move_ghost=function(a,b,c){var d=this.size(),e=this.ghost(a),f=e.lt_rect(d);f.x=Math.floor(b/(this.item_width(d)+this.options[d].gap)),f.y=Math.floor(c/(this.item_height(d)+this.options[d].gap)),f.x=Math.min(Math.max(0,f.x),this.options[d].cols-f.w),e.lt_rect(d,f)},f.prototype.end=function(){this.remove_mask(),this.remove_ghost()},f.prototype.mask=function(){return null===this.$mask&&(this.$mask=a('<div class="lt-mask" data-lt-grid="mask"></div>'),this.$element.append(this.$mask)),this.$mask},f.prototype.remove_mask=function(){null!==this.$mask&&(this.$mask.remove(),this.$mask=null)},f.prototype.grid=function(c){var d=this.size(),f=this.$element.children("[draggable]");return b===c?new e(a.map(f.toArray(),function(b){return a(b).lt_rect(d)})):void a.each(c.rects,function(a,b){f.eq(a).lt_rect(d,b)})},f.prototype.reposition=function(a,b,c){var d=this.size(),e=a.lt_rect(d),f=this.grid();f.move(e,b,c).compact(),this.grid(f),this.resize()},f.prototype.move_to_ghost=function(a){this.$element.append(a);var b=this.size(),c=this.ghost(a),d=c.lt_rect(b);!1===this.overlap&&this.reposition(a,d.x,d.y)},a.fn.lt_grid=c,a.fn.lt_grid.Constructor=f,a.lt={Grid:e,Rect:d},a(document).on("dragstart.layout-grid.data-api",'[data-arrange="layout-grid"] .lt',function(b){b.originalEvent.dataTransfer.setData("text/plain",JSON.stringify({LTWidget:"#"+a(this).lt_ensure_id().attr("id")}))}).on("dragover.layout-grid.data-api",'[data-arrange="layout-grid"]',function(b){var c=a(this),d=JSON.parse(b.originalEvent.dataTransfer.getData("text/plain")),e=b.originalEvent.clientX+a(window).scrollLeft()-c.offset().left,f=b.originalEvent.clientY+a(window).scrollTop()-c.offset().top;d&&d.LTWidget&&(b.preventDefault(),c.lt_grid("mask").lt_grid("move_ghost",a(d.LTWidget),e,f))}).on("dragend.layout-grid.data-api",'[data-arrange="layout-grid"]',function(b){a(this).lt_grid("end")}).on("dragleave.layout-grid.data-api",'[data-arrange="layout-grid"]',function(a){a.preventDefault()}).on("dragleave.layout-grid.data-api",'[data-arrange="layout-grid"]',function(b){b.preventDefault(),"mask"==a(b.target).data("lt-grid")&&a(this).lt_grid("end")}).on("drop.layout-grid.data-api",'[data-arrange="layout-grid"]',function(b){var c=JSON.parse(b.originalEvent.dataTransfer.getData("text/plain"));c&&c.LTWidget&&(b.preventDefault(),a(this).lt_grid("move_to_ghost",a(c.LTWidget)).lt_grid("end"))})}(jQuery);
